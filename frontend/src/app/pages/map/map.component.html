<div class="search-container">
  <input 
    type="text" 
    placeholder="Buscar país o especie..."
    [(ngModel)]="searchTerm"
    (input)="onSearchInput(searchTerm)"
  />

  <div class="search-results" *ngIf="searchTerm.trim().length > 0">
    <!-- Resultados de países -->
    <div class="result-section" *ngIf="filteredClusters.length > 0">
      <h4>Países:</h4>
      <ul>
        <li *ngFor="let cluster of filteredClusters" 
            (click)="onClusterClick(cluster)">
          <span class="fi fi-{{cluster.country | lowercase}}"></span>
          {{ cluster.name }} ({{ cluster.count }} especies)
        </li>
      </ul>
    </div>

    <!-- Resultados de especies -->
    <div class="result-section" *ngIf="filteredSpecies.length > 0">
      <h4>Especies:</h4>
      <ul>
        <li *ngFor="let species of filteredSpecies" 
            (click)="selectSpecies(species)">
          <span *ngIf="species.country" class="fi fi-{{species.country | lowercase}}"></span>
          {{ species.common_name }}
          <em *ngIf="species.scientific_name">({{ species.scientific_name }})</em>
        </li>
      </ul>
    </div>

    <!-- Estados de carga -->
    <div *ngIf="searchLoading" class="loading">Buscando especies...</div>
    <div *ngIf="!searchLoading && filteredClusters.length === 0 && filteredSpecies.length === 0"
         class="no-results">
      No se encontraron resultados para "{{ searchTerm }}"
    </div>
  </div>
</div>

<ngx-spinner
  bdColor="rgba(0, 0, 0, 0.8)"
  size="small"
  type="ball-spin-fade"
  color="#ffffff"
>
  <img src="../../assets/img/logos/arcticflower.png" alt="Cargando..." class="spinner-image">
</ngx-spinner>


<div #globeContainer class="globe-container"></div>

<div class="side-panel" *ngIf="selectedCluster">

  <div class="country-info">
    <span class="fi fi-{{selectedCluster.country | lowercase}}"></span>
    <h2>{{ selectedCluster.name }} {{ selectedCluster.country }} {{ selectedCluster.country }}</h2>
  </div>

  <div class="species-details" *ngIf="selectedSpecies">

    <h3>{{ selectedSpecies.common_name }}</h3>
    <p><strong>Scientific name:</strong> {{ selectedSpecies.scientific_name }}</p>
    <strong>Media:</strong>
    <div *ngIf="selectedSpecies?.media?.length" class="simple-gallery">
      <div class="image-container">
        <button class="nav-button prev" 
                (click)="prevImage()" 
                [disabled]="currentImageIndex === 0"
                aria-label="Imagen anterior">
          ‹
        </button>
        
        <div class="image-wrapper">
          <img [src]="currentImage?.identifier" 
               [alt]="currentImage?.description || 'Imagen de la especie'"
               class="main-image">
          <div class="image-counter">
            {{ currentImageIndex + 1 }} / {{ selectedSpecies.media?.length }}
          </div>
        </div>
    
        <button class="nav-button next" 
                (click)="nextImage()" 
                [disabled]="currentImageIndex === selectedSpecies.media?.length"
                aria-label="Siguiente imagen">
          ›
        </button>
      </div>
    </div>
    <img src="../../../assets/img/species_status/CRITICALLY_ENDANGERED.png" *ngIf="selectedSpecies.category=='CR'" alt="" style="width: 300px;">
    <img src="../../../assets/img/species_status/EXTINCT_IN_THE_WILD.png" *ngIf="selectedSpecies.category=='EW'" alt="" style="width: 300px;">
    <img src="../../../assets/img/species_status/EXTINCT.png" *ngIf="selectedSpecies.category=='EX'" alt="" style="width: 300px;">
    <p><strong>Categoría:</strong> {{ selectedSpecies.category }}</p>
    <p><strong>País:</strong> {{ selectedSpecies.country }}</p>
    <p><strong>Kingdom:</strong> {{ selectedSpecies.kingdom }}</p>
    <p><strong>Threats:</strong> {{ selectedSpecies.threats }}</p>
    <p><strong>Taxon_id:</strong> {{ selectedSpecies.taxon_id }}</p>
    <p><strong>Updated at:</strong> {{ selectedSpecies.updatedAt }}</p>
  
    <button (click)="closePanel()">Cerrar detalles</button>

  </div>
</div>